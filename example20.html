<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- apexcharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <style>
      body, html {
          margin: 0;
          padding: 0;
          width: 100%;
          height: 100%;
          background-color: #FFFFFF; /* 흰색 배경 */
          color: #000000; /* 기본 글자색 검정 */
          overflow: hidden; /* 스크롤바 제거 */
      }
      #chart {
          width: 100%;
          height: 100%;
          background-color: #FFFFFF; /* 차트 컨테이너 흰색 */
      }
  </style>
</head>
<body>
  <div id="chart"></div>

  <script>
    async function 가져오기() {
      const 응답 = await fetch('20.json'); 
      const base64Data = await 응답.text(); 
      const jsonData = JSON.parse(atob(base64Data)); 
      return jsonData;
    }

    가져오기()
      .then(data => {
        // ApexCharts에서 datetime 타입을 제대로 인식시키려면
        // 시간 값을 '2025-03-02' 같은 YYYY-MM-DD 문자열 또는
        // '2025-03-02T00:00:00Z' 같은 ISO8601 형식, 혹은 UNIX 타임(ms) 등으로 전달하면 됩니다.
        // 여기서는 time을 'YYYY-MM-DD' 형태로 사용한다고 가정.
        const time = data.map(item => {
          // 예시: item.time이 "2025-03-02"와 같은 문자열을 반환한다고 가정
          // 만약 item.time이 다른 형식이라면 new Date(item.time).toISOString().split('T')[0] 형태로 변환
          return new Date(item.time).toISOString().split('T')[0];
        });

        const inflow = data.map(item => item.inflow);
        const netflow = data.map(item => item.netfolow);
        const outflow = data.map(item => item.outflow);

        var options = {
          chart: {
            type: 'line',
            height: '100%',
            width: '100%',
            background: '#FFFFFF',
            toolbar: {
              show: false // 모든 버튼 숨김
            },
            zoom: {
              enabled: false // 줌 비활성화
            }
          },
          // datetime 타입 사용
          xaxis: {
            type: 'datetime',
            // xaxis 라벨 포맷 지정
            labels: {
              datetimeFormatter: {
                // 필요한 단위에 맞춰 모두 동일 포맷으로 설정
                year: 'yyyy-MM-dd',
                month: 'yyyy-MM-dd',
                day: 'yyyy-MM-dd',
                hour: 'yyyy-MM-dd'
              },
              rotate: -45,
              style: {
                fontSize: '10px',
                colors: '#000000'
              }
            },
            // 실제로 사용할 데이터 (series 대신 xaxis에 categories 없이, 각 시리즈의 data에서 x,y를 지정하는 방법도 가능)
            categories: time,
            axisBorder: {
              color: '#999999'
            },
            axisTicks: {
              color: '#999999'
            }
          },
          yaxis: {
            labels: {
              style: {
                colors: '#000000'
              },
              formatter: function(value) {
                // K, M, B 단위로 축약
                const absValue = Math.abs(value);
                if (absValue >= 1.0e9) {
                  return (value / 1.0e9).toFixed(2) + "B";
                } else if (absValue >= 1.0e6) {
                  return (value / 1.0e6).toFixed(2) + "M";
                } else if (absValue >= 1.0e3) {
                  return (value / 1.0e3).toFixed(2) + "K";
                } else {
                  return value.toFixed(1);
                }
              }
            },
            axisBorder: {
              color: '#999999'
            },
            axisTicks: {
              color: '#999999'
            }
          },
          series: [
            {
              name: 'Inflow',
              data: inflow
            },
            {
              name: 'Netflow',
              data: netflow,
              stroke: {
                width: 4
              }
            },
            {
              name: 'Outflow',
              data: outflow
            }
          ],
          colors: ['#1f77b4', '#ff7f0e', '#2ca02c'],
          stroke: {
            curve: 'smooth',
            width: [2, 4, 2]
          },
          markers: {
            size: [0, 0, 0]
          },
          legend: {
            labels: {
              colors: '#000000'
            }
          },
          tooltip: {
            // tooltip에서 x값 날짜 형식 지정
            x: {
              format: 'yyyy-MM-dd' // 툴팁 상단의 x값을 yyyy-MM-dd로 표시
            },
            theme: 'light',
            style: {
              fontSize: '16px',
              fontFamily: 'Arial, sans-serif',
              color: '#000000'
            },
            marker: {
              fillColors: ['#1f77b4', '#ff7f0e', '#2ca02c']
            },
            y: {
              formatter: function(value) {
                // 툴팁에서 y값 표현 (소수점 한 자리, 3자리마다 콤마)
                return value ? value.toFixed(1).toLocaleString() : '';
              },
              title: {
                formatter: (seriesName) => seriesName,
                style: {
                  color: '#666666'
                }
              }
            }
          },
          grid: {
            borderColor: '#cccccc'
          }
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
      })
      .catch(error => console.error('Error fetching data:', error));
  </script>
</body>
</html>
